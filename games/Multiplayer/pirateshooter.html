<html>

<head>
    <meta charset="UTF-8" />
    <title>Multiplayer Experiment</title>
    <!-- Load the Phaser game library -->
    <script src="//cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser.js"></script>

</head>

<body>
    <script type="text/javascript">
        let config = {
            // 오토로 캔버스 만들어줌
            type: Phaser.AUTO,
            // 위 아래 크기 조정
            width: 800,
            height: 600,

            physics: {
                default: 'arcade',
                arcade: {
                    gravity: {
                        y: 0
                    }
                }
            },
            // 사용하는 신 지정
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        let game = new Phaser.Game(config);

        let player;
        //이동 관련
        let cursors;
        // 공격 관련
        let bullet;

        function preload() {
            this.load.image('water', 'assets/water_tile.png');
            this.load.image('bullet', 'assets/cannon_ball.png');
            this.load.image('ship', 'assets/ship1_1.png');
        }

        function create() {
            this.add.tileSprite(0, 0, config.width, config.height, 'water').setOrigin(0, 0);

            // 플레이어 생성(맵 가운데)
            player = this.physics.add.sprite(config.width / 2, config.height / 2, 'ship');
            player.setCollideWorldBounds(true);

            // 화살표와 wasd 모두 사용할 수 있도록 설정
            cursors = this.input.keyboard.addKeys({
                'up1': Phaser.Input.Keyboard.KeyCodes.UP,
                'up2': Phaser.Input.Keyboard.KeyCodes.W,
                'down1': Phaser.Input.Keyboard.KeyCodes.DOWN,
                'down2': Phaser.Input.Keyboard.KeyCodes.S,
                'left1': Phaser.Input.Keyboard.KeyCodes.LEFT,
                'left2': Phaser.Input.Keyboard.KeyCodes.A,
                'right1': Phaser.Input.Keyboard.KeyCodes.RIGHT,
                'right2': Phaser.Input.Keyboard.KeyCodes.D,
                'space': Phaser.Input.Keyboard.KeyCodes.SPACE,
                'shift': Phaser.Input.Keyboard.KeyCodes.SHIFT
            });

            bullets = this.physics.add.group();

            // 맵 모든 영역을 클릭하면 반응하도록 해주는 함수
            this.input.on('pointerdown', function() {
                let bullet = bullets.create(player.x, player.y, 'bullet');
                // 맵 바깥으로 나가도록
                bullet.setCollideWorldBounds(false);
                // 
                bullet.rotation = (Phaser.Math.Angle.Between(player.x, player.y, this.input.mousePointer.x, this.input.mousePointer.y) - 1.5);
                bullet.setVelocity(player.x, player.y);

            });
        }


        function update() {
            // 좌우 컨트롤
            if (cursors.left1.isDown || cursors.left2.isDown) {
                player.setVelocityX(-300);
            } else if (cursors.right1.isDown || cursors.right2.isDown) {
                player.setVelocityX(300);
            } else {
                player.setVelocityX(0);
            }

            // 상하 컨트롤
            if (cursors.up1.isDown || cursors.up2.isDown) {
                player.setVelocityY(-300);
            } else if (cursors.down1.isDown || cursors.down2.isDown) {
                player.setVelocityY(300);
            } else {
                player.setVelocityY(0);
            }

            // 유저의 뱃머리를 마우스 커서 위치로 항상 돌아가도록 설정
            player.rotation = (Phaser.Math.Angle.Between(player.x, player.y, this.input.mousePointer.x, this.input.mousePointer.y) - 1.5);


        }
    </script>

</body>

</html>